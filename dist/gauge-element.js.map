{"version":3,"sources":["gauge-element.coffee"],"names":[],"mappings":"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","file":"gauge-element.js","sourceRoot":"/source/","sourcesContent":["Polymer 'gauge-element',\n  publish:\n    data: []\n    value: 0\n    aperture: 270\n\n  ready: ->\n    paperWidth = @.offsetWidth\n\n    if @.aperture < 180\n      paperHeight = @.offsetWidth/2 + 20\n    else if @.aperture < 360\n      alpha = (180-(360-@.aperture))/2\n      h = @.offsetWidth/2 * Math.sin(Math.PI*alpha/180)\n      paperHeight = @.offsetWidth/2 + h\n    else paperHeight = @.offsetWidth\n\n    @.paper = Raphael(@.$.gauge, paperWidth, paperHeight)\n    @.arcs = @.paper.set()\n    @.marks = @.paper.set()\n    @.labels = @.paper.set()\n    @.startAngle = 90 + (360 - @.aperture)/2\n\n    @.center =\n      x: @.offsetWidth/2\n      y: @.offsetWidth/2\n\n    @.drawArrow @.startAngle\n\n#  Рисуем сектор\n  drawArc: (start, end, radius, color) ->\n    startAngle = @.getPointOnCircle radius, start\n    endAngle = @.getPointOnCircle radius, end\n    arc = @.paper.path(\"M\" + startAngle.x + \",\" + startAngle.y + \" A\" + radius + \",\" + radius + \" 0 0,1 \" + endAngle.x + \",\" + endAngle.y)\n    if !color\n      arc.node.setAttribute('class', 'arc arc--default')\n    else\n      arc.node.setAttribute('class', 'arc arc--with-color')\n      arc.attr({\"stroke\": color})\n    @.arcs.push arc\n\n#  Рисуем шкалу\n  drawSegments: ->\n    @.startAngle = 90 + (360 - @.aperture)/2\n    @.angle = @.aperture/(@.data.length-1)\n    arkStartAngle = @.startAngle - @.angle/2\n    for d, i in @.data\n      color = if d.color then d.color\n      endAngle = arkStartAngle + @.angle\n      switch i\n        when 0\n#          console.log \"first arc drawing\"\n          @.drawArc(arkStartAngle + @.angle/2, endAngle, 180, color)\n        when @.data.length-1\n#          console.log \"last arc drawing\"\n          @.drawArc(arkStartAngle, endAngle - @.angle/2, 180, color)\n        else\n#          console.log \"arc drawing\"\n          @.drawArc(arkStartAngle, endAngle, 180, color)\n      arkStartAngle += @.angle\n\n#  Рисуем точки\n  drawMarks: (R, total) ->\n    for i in [0..total]\n      angle = @.aperture / total\n      pos = @.getPointOnCircle R, angle*i\n      mark =  @.paper.circle(pos.x, pos.y, 1).rotate(@.startAngle, @.center.x, @.center.y)\n      mark.node.setAttribute('class', 'mark')\n      @.marks.push mark\n\n#  Рисуем значения\n  drawLabels: (R) ->\n    for d, i in @.data\n      markStartPos = @.getPointOnCircle R, @.getArcCenter i\n      markEndPos = @.getPointOnCircle R + 5, @.getArcCenter i\n      labelPos = @.getPointOnCircle R + 15, @.getArcCenter i\n\n      label =  @.paper.path(\"M\" + markStartPos.x + \",\" + markStartPos.y + \" L\" + markEndPos.x + \",\" + markEndPos.y + \" z\")\n      label.node.setAttribute('class', 'label label__mark')\n      @.labels.push label\n\n      if typeof d == \"number\" or typeof d == \"string\"\n        labelText = @.paper.text(labelPos.x, labelPos.y, d)\n      else\n        labelText = @.paper.text(labelPos.x, labelPos.y, d.label)\n      labelText.node.setAttribute('class', 'label label__text')\n      @.labels.push labelText\n\n#  Рисуем стрелку под заданным углом\n  drawArrow: (angle) ->\n#    Стрелка\n    @.arrow = @.paper.path(\"M\" + @.center.x + \",\" + @.center.y + \" m0,-5 l190,5 l-190,5 z\")\n      .transform(\"r\" + angle + \",\" + @.center.x + \",\" + @.center.y)\n    @.arrow.node.setAttribute('class', 'arrow')\n#    Основание стрелки\n    @.paper.circle(@.center.x, @.center.y, 10)\n      .node.setAttribute('class', 'arrow arrow__base')\n\n  draw: ->\n#    Удаляем отрисованные элементы\n    @.arcs.remove()\n    @.labels.remove()\n    @.marks.remove()\n\n    @.drawSegments()\n    @.drawMarks 190, (@.data.length-1)*10\n    @.drawLabels 190\n    @.rotateArrow @.getArcCenter @.value\n\n#  Поворот стрелки на заданный угол\n  rotateArrow: (angle) ->\n    @.arrow.animate\n      transform: \"r\" + angle + \",\" + @.center.x + \",\" + @.center.y\n    , 500, \"<>\"\n\n#  Позвращает объект с координатами точки находящейся под заданным углом на окружности заданного радиуса\n  getPointOnCircle: (radius, angle) ->\n    x: @.center.x + radius * Math.cos(Math.PI*angle/180)\n    y: @.center.y + radius * Math.sin(Math.PI*angle/180)\n\n#  Возворащает угол в градусах который соответствует середине сектора\n  getArcCenter: (value) -> @.startAngle + @.angle * parseInt(value)\n\n#  Поворачиваем стрелку при изменение атрибута value\n  valueChanged: (oldValue, newValue) -> @.rotateArrow @.getArcCenter newValue\n\n# Перерисовываем шкалу и метки при изменении атрибутов data и aperture\n  dataChanged: -> @.draw()\n  apertureChanged: -> @.draw()\n"]}